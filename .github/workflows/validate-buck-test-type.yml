name: Buck Module Test Type Validation
on:
  pull_request:
    path:
      - '**/BUCK'
    branches:
      - 'master'
jobs:
  validate-new-buck-module:
    name: Validate new BUCK file
    runs-on: ubuntu-latest
    steps:
      - name: Check out branch
        uses: actions/checkout@v3
      - name: Fetch new changed files
        id: buck_files
        run: |
          git fetch origin master
          git diff --name-status origin/master ${{ github.event.pull_request.head.sha }} | grep '^A' | grep BUCK | awk '{print $2}' > buck_files.txt
          echo "::set-output name=buck_files::$(cat buck_files.txt)"

      - name: Validate new file
        run: |
          changed_files="${{ steps.buck_files.outputs.buck_files }}"
          echo "Changed Files:"
          echo "$changed_files"
